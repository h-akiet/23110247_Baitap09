<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Quản lý User</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

  <h1 class="mb-4 text-primary">Quản lý User</h1>

  <!-- Create -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white">Thêm User</div>
    <div class="card-body">
      <form id="createForm" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Họ tên</label>
          <input type="text" class="form-control" id="fullname" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="email" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="password" required>
        </div>
        <div class="col-md-6">
          <label class="form-label">Phone</label>
          <input type="text" class="form-control" id="phone">
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-success">Thêm</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Update -->
  <div class="card mb-4">
    <div class="card-header bg-warning">Cập nhật User</div>
    <div class="card-body">
      <form id="updateForm" class="row g-3">
        <div class="col-md-2">
          <label class="form-label">ID</label>
          <input type="number" class="form-control" id="uid" required>
        </div>
        <div class="col-md-5">
          <label class="form-label">Họ tên</label>
          <input type="text" class="form-control" id="ufullname">
        </div>
        <div class="col-md-5">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="uemail">
        </div>
        <div class="col-md-6">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="upassword">
        </div>
        <div class="col-md-6">
          <label class="form-label">Phone</label>
          <input type="text" class="form-control" id="uphone">
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-warning">Cập nhật</button>
        </div>
      </form>
    </div>
  </div>

  <!-- List -->
  <div class="card">
    <div class="card-header bg-info text-white">Danh sách User</div>
    <ul id="userList" class="list-group list-group-flush"></ul>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const endpoint = "/graphql";

    // Hiển thị danh sách user
    function loadUsers() {
      const query = `query {
        users { id fullname email phone }
      }`;
      fetch(endpoint, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({query})
      })
      .then(res => res.json())
      .then(res => {
        const ul = document.getElementById("userList");
        ul.innerHTML = "";
        res.data.users.forEach(u => {
          const li = document.createElement("li");
          li.className = "list-group-item d-flex justify-content-between align-items-center";
          li.innerHTML = `
            <div>
              <strong>#${u.id}</strong> - ${u.fullname} 
              <br><small>${u.email} | ${u.phone}</small>
            </div>
            <button class="btn btn-sm btn-danger" onclick="deleteUser(${u.id})">Xóa</button>`;
          ul.appendChild(li);
        });
      });
    }

    // Create user
    document.getElementById("createForm").onsubmit = e => {
      e.preventDefault();
      const mutation = `mutation {
        createUser(input: {
          fullname: "${fullname.value}",
          email: "${email.value}",
          password: "${password.value}",
          phone: "${phone.value}"
        }) { id fullname }
      }`;
      fetch(endpoint, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({query: mutation})
      }).then(() => loadUsers());
    };

    // Update user
    document.getElementById("updateForm").onsubmit = e => {
      e.preventDefault();
      const mutation = `mutation {
        updateUser(id: ${uid.value}, input: {
          fullname: "${ufullname.value}",
          email: "${uemail.value}",
          password: "${upassword.value}",
          phone: "${uphone.value}"
        }) { id fullname email phone }
      }`;
      fetch(endpoint, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({query: mutation})
      }).then(() => loadUsers());
    };

    // Delete user
    function deleteUser(id) {
      const mutation = `mutation { deleteUser(id: ${id}) }`;
      fetch(endpoint, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({query: mutation})
      }).then(() => loadUsers());
    }

    // load ban đầu
    loadUsers();
  </script>
</body>
</html>